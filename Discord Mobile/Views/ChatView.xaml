<Page
    x:Class="Discord_Mobile.ChatView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Discord_Mobile"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:Discord_Mobile.ViewModels"
    xmlns:conv="using:Discord_Mobile.Converters"
    xmlns:discweb="using:Discord.WebSocket"
    xmlns:disc="using:Discord"
    mc:Ignorable="d">

    <Page.DataContext>
        <vm:ChatViewModel x:Name="ChatViewModel"/>
    </Page.DataContext>

    <Page.Resources>
        <Style TargetType="Button" x:Key="TopMenuButtons">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="32"/>
            <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
        </Style>
        <conv:ImageConverter x:Key="ImageConverter"/>
        <conv:TimeToStringConverter x:Key="TimeToStringConverter"/>
        <conv:StringShortenerConverter x:Key="StringShortenerConverter"/>

        <DataTemplate x:Key="GuildsListDataTemplate" x:DataType="discweb:SocketGuild">
            <StackPanel Margin="0,5,0,0">
                <Ellipse Width="40" Height="40">
                    <Ellipse.Fill>
                        <ImageBrush ImageSource="{x:Bind IconUrl, Mode=OneWay,Converter={StaticResource ImageConverter}}"/>
                    </Ellipse.Fill>
                </Ellipse>
                <TextBlock TextAlignment="Center" TextWrapping="WrapWholeWords" Margin="0,2,0,0" Text="{x:Bind Name, Mode=OneWay}" Foreground="White" FontSize="12" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="TextChannelListDataTemplate" x:DataType="discweb:SocketGuildChannel">
            <StackPanel Margin="0,5,0,0">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="# " FontSize="14" Foreground="Gray"/>
                    <TextBlock TextAlignment="Center" TextWrapping="WrapWholeWords" Margin="0,2,0,0" Text="{x:Bind Name, Mode=OneWay,Converter={StaticResource StringShortenerConverter}}" Foreground="White" FontSize="12" />
                </StackPanel>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="VoiceChannelListDataTemplate" x:DataType="discweb:SocketGuildChannel">
            <StackPanel Margin="0,5,0,0">
                <TextBlock TextAlignment="Center" TextWrapping="WrapWholeWords" Margin="0,2,0,0" Text="{x:Bind Name, Mode=OneWay,Converter={StaticResource StringShortenerConverter}}" Foreground="White" FontSize="12" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="MessageListDataTemplate" x:DataType="disc:IMessage">
            <Border Background="#2C2F33" CornerRadius="5">
                <StackPanel Margin="5">
                    <StackPanel Orientation="Horizontal" Margin="5,2,0,0">
                        <TextBlock TextAlignment="Left" Text="{x:Bind Author,Mode=OneWay}" Foreground="White" FontSize="14"/>
                        <TextBlock TextAlignment="Left" Margin="5,3,0,0" Text="{x:Bind Timestamp,Mode=OneWay,Converter={StaticResource TimeToStringConverter}}" Foreground="LightGray" FontSize="10"/>
                    </StackPanel>
                    <TextBlock TextAlignment="Left" Margin="10,2,0,0" TextWrapping="WrapWholeWords" Text="{x:Bind Content, Mode=OneWay}" Foreground="#99AAB5" FontSize="20" />
                </StackPanel>
            </Border>
        </DataTemplate>
    </Page.Resources>

    <Grid Background="#7289DA">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Background="#23272A"/>
        <Button HorizontalAlignment="Left" Width="80" Click="OpenSplitView" Style="{StaticResource TopMenuButtons}" Content="&#xE25C;"/>
        <StackPanel>
            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                <StackPanel Margin="0,0,10,0">
                    <TextBlock Text="{x:Bind ChatViewModel.UserName, Mode=OneWay}" FontSize="16" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="{x:Bind ChatViewModel.UserStatus, Mode=OneWay}" FontSize="12" FontWeight="Bold" Margin="5,2,0,0" Foreground="{x:Bind ChatViewModel.userStatusColor, Mode=OneWay}"/>
                </StackPanel>
                <Ellipse Loaded="{x:Bind ChatViewModel.SetUser}" Width="40" Height="40" Margin="0,2,5,0">
                    <Ellipse.Fill>
                        <ImageBrush ImageSource="{x:Bind ChatViewModel.UserAvatar, Mode=OneWay}"/>
                    </Ellipse.Fill>
                </Ellipse>
            </StackPanel>
        </StackPanel>

        <SplitView Grid.Row="1" PaneBackground="#2C2F33" IsPaneOpen="False" DisplayMode="CompactOverlay" CompactPaneLength="80" OpenPaneLength="220" Name="ChannelsSplitView">
            <SplitView.Pane>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <ListView Loaded="{x:Bind ChatViewModel.SetGuilds}" ScrollViewer.VerticalScrollBarVisibility="Auto" ItemClick="{x:Bind ChatViewModel.SetGuildChannels}" ItemsSource="{x:Bind ChatViewModel.GuildsList, Mode=OneWay}" IsItemClickEnabled="True" ItemTemplate="{StaticResource GuildsListDataTemplate}">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            </Style>
                        </ListView.ItemContainerStyle>
                    </ListView>
                    <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <TextBlock Foreground="White" FontWeight="Bold" FontSize="12" Margin="5,10,0,10" Text="TEXT CHANNELS"/>
                            <ListView ItemClick="{x:Bind ChatViewModel.SetChannelMessages}" IsItemClickEnabled="True" ItemsSource="{x:Bind ChatViewModel.TextChannelsList, Mode=OneWay}" ItemTemplate="{StaticResource TextChannelListDataTemplate}"/>
                            <TextBlock Foreground="White" FontWeight="Bold" FontSize="12" Margin="5,10,0,10" Text="VOICE CHANNELS"/>
                            <ListView ItemsSource="{x:Bind ChatViewModel.VoiceChannelsList, Mode=OneWay}" IsItemClickEnabled="True" ItemTemplate="{StaticResource VoiceChannelListDataTemplate}"/>
                        </StackPanel>
                    </ScrollViewer>
                    <Button VerticalAlignment="Bottom" Height="60" Width="80" Click="{x:Bind ChatViewModel.GoToSettings}" Style="{StaticResource TopMenuButtons}" Content="&#xE713;"/>
                </Grid>
            </SplitView.Pane>
            <SplitView.Content>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="40"/>
                    </Grid.RowDefinitions>
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ListView VerticalContentAlignment="Bottom" ItemsSource="{x:Bind ChatViewModel.MessageList, Mode=OneWay}" SelectionMode="None" ItemTemplate="{StaticResource MessageListDataTemplate}">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    <Setter Property="Margin" Value="0,0,5,5"/>
                                </Style>
                            </ListView.ItemContainerStyle>
                        </ListView>
                    </ScrollViewer>
                    <RelativePanel Grid.Row="1">
                        <TextBox RelativePanel.AlignLeftWithPanel="True" RelativePanel.LeftOf="SendButton" Background="#2C2F33" Foreground="#99AAB5" RelativePanel.AlignBottomWithPanel="True" RelativePanel.AlignTopWithPanel="True"/>
                        <Button RelativePanel.AlignRightWithPanel="True" RelativePanel.AlignBottomWithPanel="True" RelativePanel.AlignTopWithPanel="True" Name="SendButton" Width="40" VerticalAlignment="Stretch" Content="&#xE8BD;" FontFamily="Segoe MDL2 Assets"/>
                    </RelativePanel>
                </Grid>
            </SplitView.Content>
        </SplitView>
        <!--
        <CommandBar Grid.Row="2" Foreground="White" Background="#23272A">
            <CommandBar.Content>
                <Grid/>
            </CommandBar.Content>
            <AppBarButton Foreground="White" Click="{x:Bind ChatViewModel.Disconnect}" Icon="DisconnectDrive" Label="Sign Out"/>
            <AppBarButton Foreground="White" Icon="Refresh" Label="Refresh Chat"/>
            <AppBarButton Foreground="White" Icon="Add" Label="Add Channel"/>
        </CommandBar>-->
    </Grid>
</Page>
